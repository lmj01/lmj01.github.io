# Coroutine

协程，是改变代码执行流程的一种技术手段。

按其实现可分为有栈和无栈。

有栈
需要分配一定数量的内存以适应其运行时堆栈，且上下文切换非常昂贵
可以随意切换，所有的状态都在协程内部，且可并行。可以嵌套挂起。


无栈，需要满足的条件有
- 栈帧内保存的不是状态而是指向状态的指针
- 所有帧的状态保存在堆上

只能手动切换，切换控制权也在用户手中，效率高，唯一需要维护的是程序计数器PC。


协程按照调度方式可分为对称协程和非对称协程。
- Symmetric Coroutine对称协程提供了一种类似goto的操作将控制权直接传递给其他指定的协程，调用者与被调用者之间的关系是平等的，可以在任意协程中转移
- Asymmetric Coroutine非对称协程，需要暂停与恢复两种操作，具有明确的层级关系，被调用者必须先返回再调用其他协程

[C++20](https://en.cppreference.com/w/cpp/language/coroutines)中协程是非对称协程，它借助于编译器在编译期插入相关代码，记录响应跳转点，运行期根据协程状态计算跳转地址实现协程的功能

[coroutine in c](https://mthli.xyz/coroutines-in-c/)
[duff device达夫设备](https://mthli.xyz/duff-device/)