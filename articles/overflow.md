# 计算溢出

## 浮点数

```c++
float x = 80838.0f;
float y = -2499.0f;
double xy = x * y;
```
有两种结果，-202014160和-202014162
32位浮点数在计算机中的表示形式为：符号S1位，指数E8位，有效数字M23位

float = (-1)^s * (1 + M) * 2^(E-127)

80838.0=1.0011 1011 1100 0110 0 * 2^16
M = 0011 1011 1100 0110 0000 000
E = 16 + 127 = 143 = 1000 1111
S = 0

-2499.0 = -1.0011 1000 0110 * 2^11
M = 0011 1000 0110 0000 0000 000 
E = 11 + 127 = 138 = 1000 1010
S = 1

相乘的中间结果为：
E = 11 + 16 + 127 = 154 = 1001 1010
M = 1000 0001 0100 1111 1011 1010 01共有26位，后3位被截断
S = 1

result1 = -1.1001 1010 1000 0001 0100 1111 1011 101 * 2 ^ 27
result2 = -1.1001 1010 1000 0001 0100 1111 1011 1010 01 * 2 ^ 27

浮点运算标准IEEE-754标准推荐实现者提供浮点可扩展精度格式Extended precision，就是面对这种情形: x * y / z, x与y相乘可能超出表示范围，但除z后又回到有效范围内，FPU(float point unit)浮点运算处理器支持这种扩展来保证结果，而非FPU就得不到精确结果。

这说明代码得保证实际运行环境、测试环境、开发环境的一致性(OS架构，编译选项等)，不然产生bug时就很难分析出来。


